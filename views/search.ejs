<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小故事铺 - 搜索精彩故事，发现温暖与惊喜</title>
    <link rel="icon" type="image/png" href="/images/story.png">
    <link rel="stylesheet" href="/stylesheets/search.css">
    <link rel="stylesheet" href="/stylesheets/all.min.css">
    <link rel="stylesheet" href="/live2d/css/live2d.css"/>
    <script type="text/javascript" src="/javascripts/jquery.min.js"></script>
</head>
    <body>
        <header class="home-header">
            <div class="brand">
                <img src="/images/story.png" alt="小故事铺" class="brand-logo">
                <span class="brand-name">小故事铺</span>
            </div>
            <button class="search-close" id="searchClose" aria-label="关闭">
                <i class="fas fa-times"></i>
            </button>
        </header>
        <main>
            <div class="floating-search" id="floatingSearch">

                <div class="floating-search-container">
                    <div class="hero">
                        <h1 class="hero-title">搜一则故事，遇见一份心情</h1>
                        <p class="hero-subtitle">支持搜索标题、摘要与分类，回车即刻呈现</p>
                        <div class="search-bar">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" id="searchInput" placeholder="试试：睡前、恐怖、亲情、儿童、励志…">
                        </div>
                        <div class="quick-tags" id="quickTags">
                            <button class="tag" data-tag="睡前">睡前</button>
                            <button class="tag" data-tag="恐怖">恐怖</button>
                            <button class="tag" data-tag="童话">童话</button>
                            <button class="tag" data-tag="儿童">儿童</button>
                            <button class="tag" data-tag="益智">益智</button>
                            <button class="tag" data-tag="历史">历史</button>
                            <button class="tag" data-tag="预言">预言</button>
                            <button class="tag" data-tag="成语">成语</button>
                            <button class="tag" data-tag="格林">格林</button>
                            <button class="tag" data-tag="作文">作文</button>
                        </div>
                        <!-- 插画区域：展示开源免费插画（unDraw，MIT License） -->
                        <div class="search-illustrations" aria-label="主题插画">
                            <figure class="illustration-item">
                                <img src="/images/chahua5.png" alt="阅读爱好者插画（来自 unDraw）"loading="lazy" decoding="async"/>
                            </figure>
                        </div>
                    </div>
                </div>

                <!-- 搜索结果区域：单列列表样式 + 空状态 -->
                <div class="search-results">
                    <div class="list-header">
                        <span class="list-label"><i class="fas fa-star"></i> <%=title %></span>
                    </div>
                    <div class="results-list" id="resultsList">
                        <% storyList.forEach(function(story){ %>
                        <article class="list-item">
                            <h2 class="list-title">
                                <i class="fas fa-star star-icon" aria-hidden="true"></i>
                                <a href="/story/<%=story.id %>" target="_blank" rel="noopener"><%=story.title %></a>
                            </h2>
                            <div class="list-meta">分类：<%=story.category_name %></div>
                            <p class="list-excerpt"><%=story.excerpt %></p>
                        </article>
                        <% }); %>
                    </div>
                    <div class="empty-state" id="emptyState" style="display:none;">
<!--                         <i class="fas fa-search"></i> -->
                        <p>没有找到相关故事，试试其他关键词～</p>
                    </div>
                </div>

                <div id="landlord">
                    <div class="message" style="opacity:0"></div>
                    <canvas id="live2d" width="560" height="500" class="live2d"></canvas>
                    <div class="hide-button">隐藏</div>
                </div>
            </div>
        </main>
        <script type="text/javascript" src="/live2d/js/live2d.js"></script>
        <script type="text/javascript" src="/live2d/js/message.js"></script>
        <script type="text/javascript">
            loadlive2d("live2d", "/live2d/model/xiaoban/model.json");
        </script>
        <script src="/javascripts/search.js"></script>
<!--         <script> -->
<!--             document.addEventListener('DOMContentLoaded', async () => { -->
<!--                 // 打开搜索与主题 -->
<!--                 toggleSearchBox(); -->
<!--                 checkSavedTheme(); -->

<!--                 // 事件绑定 -->
<!--                 const closeBtn = document.getElementById('searchClose'); -->
<!--                 closeBtn?.addEventListener('click', closeSearchBox); -->

<!--                 const searchInput = document.getElementById('searchInput'); -->
<!--                 if (searchInput) { -->
<!--                     searchInput.addEventListener('keydown', async (e) => { -->
<!--                         if (e.key === 'Enter') { -->
<!--                             debugger -->
<!--                             const keyword = (searchInput?.value || '').trim().toLowerCase(); -->
<!--                             const res = await fetch('/story/search/page?keyword=' + keyword,{ -->
<!--                                 headers: {'x-search': 'true'} -->
<!--                             }); -->
<!--                         } -->
<!--                     }); -->
<!--                 } -->
<!--             }); -->

<!--             function toggleSearchBox() { -->
<!--                 const searchBox = document.getElementById('floatingSearch'); -->
<!--                 const searchInput = document.getElementById('searchInput'); -->
<!--                 if(currentState.searchKeyword){ -->
<!--                     searchInput.value = currentState.searchKeyword; -->
<!--                 } -->
<!--                 if (!searchBox.classList.contains('active')) { -->
<!--                     searchBox.classList.add('active'); -->
<!--                 } -->
<!--                 setTimeout(() => searchInput.focus(), 300); -->
<!--             } -->

<!--             function closeSearchBox() { -->
<!--                 const searchInput = document.getElementById('searchInput'); -->
<!--                 searchInput.value = ''; -->
<!--                 currentState.searchKeyword = ''; -->
<!--             } -->

<!--             function checkSavedTheme() { -->
<!--                 const savedTheme = localStorage.getItem('theme'); -->
<!--                 if (savedTheme === 'dark') { -->
<!--                     document.body.classList.add('dark-theme'); -->
<!--                 } -->
<!--             } -->
<!--         </script> -->
    </body>
 </html>
